<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>Exercise 2.2: Using a combination of modules to perform a graceful rollback</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="Exercise 2.2: Using a combination of modules to perform a graceful rollback"/>
  <meta name="product" content="F5 Solutions for Containers"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2020-02-26 07:28:24"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 Solutions for Containers" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Exercise 2.2: Using a combination of modules to perform a graceful rollback &#8212; F5 Solutions for Containers  documentation</title>
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5_agility_theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/CoveoFullSearch.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/21fb8a09c3.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Section 3 - Ansible F5 AS3 Exercises" href="../module3/module3.html" />
    <link rel="prev" title="Exercise 2.1: Using a combination of modules to delete configuration on the BIG-IP" href="2.1-delete-configuration.html" /> 
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>F5 Solutions for Containers  </h5>
        

        <hr>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../class01/class01.html">Class 1: Programmability - Introduction to BIG-IP Rest Structure and Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class02/class02.html">Class 2: A&amp;O Toolchain 111: BIG-IP Deployments with Declarative Onboarding (DO)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class03/class03.html">Class 3: Application Deployments with BIG-IP and Application Services (AS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class04/class04.html">Class 4: A&amp;O Tool Chain - BIG-IP Service Analytics and Metrics with Telemetry Streaming (TS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class05/class05.html">Class 5: A&amp;O Tool Chain - Advanced Design Patterns with AS3, DO and TS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class06/class06.html">Class 6: Programmability - CI/CD Process Integration with BIG-IP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class07/class07.html">Class 7: Dude Where's My Services: Introduction to Service Discovery with Consul</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class08/class08.html">Class 8: Containers - Kubernetes &amp; OpenShift Integration with BIG-IP</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../class09.html">Class 9: Basic BIG-IP Configuration Management with Ansible</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class10/class10.html">Class 10: Advanced BIG-IP Configuration Management with Ansible</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class11/class11.html">Class 11: 101 of Terraform BIG-IP Provider</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class12/class12.html">Class 12: Cisco ACI Integration with BIG-IP</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Exercise 2.2: Using a combination of modules to perform a graceful rollback</a><ul>
<li><a class="reference internal" href="#objective">Objective</a></li>
<li><a class="reference internal" href="#guide">Guide</a><ul>
<li><a class="reference internal" href="#step-1">Step 1</a></li>
<li><a class="reference internal" href="#step-2">Step 2</a></li>
<li><a class="reference internal" href="#step-3">Step 3</a></li>
<li><a class="reference internal" href="#step-4">Step 4</a></li>
<li><a class="reference internal" href="#step-5">Step 5</a></li>
<li><a class="reference internal" href="#step-6">Step 6</a></li>
<li><a class="reference internal" href="#step-7">Step 7</a></li>
<li><a class="reference internal" href="#step-7-1">Step 7</a></li>
<li><a class="reference internal" href="#step-8">Step 8</a></li>
<li><a class="reference internal" href="#step-9">Step 9</a></li>
</ul>
</li>
<li><a class="reference internal" href="#playbook-output">Playbook Output</a></li>
<li><a class="reference internal" href="#solution">Solution</a></li>
</ul>
</li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../../index.html">F5 Solutions for Containers</a>
              &gt; <a href="../class09.html">Class 9: Basic BIG-IP Configuration Management with Ansible</a>
              &gt; <a href="module2.html">Section 2 - Ansible F5 Operational/Advanced Exercises</a>

          <span class="right">
             <a href="../../_sources/class09/module2/2.2-error-handling.rst.txt" rel="nofollow">Source</a> |
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="exercise-2-2-using-a-combination-of-modules-to-perform-a-graceful-rollback">
<span id="error-handling"></span><h1>Exercise 2.2: Using a combination of modules to perform a graceful rollback<a class="headerlink" href="#exercise-2-2-using-a-combination-of-modules-to-perform-a-graceful-rollback" title="Permalink to this headline">¶</a></h1>
<div class="section" id="objective">
<h2>Objective<a class="headerlink" href="#objective" title="Permalink to this headline">¶</a></h2>
<p>Demonstrate use of the different modules to perform a rollback of the
configuration on the BIG-IP.</p>
</div>
<div class="section" id="guide">
<h2>Guide<a class="headerlink" href="#guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="step-1">
<h3>Step 1<a class="headerlink" href="#step-1" title="Permalink to this headline">¶</a></h3>
<p>Using your text editor of choice create a new file called
<code class="docutils literal notranslate"><span class="pre">bigip-error-handling.yml</span></code>.</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[centos@ansible ~]$</span> nano bigip-error-handling.yml
</pre></div>
</div>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">vim</span></code> and <code class="docutils literal notranslate"><span class="pre">nano</span></code> are available on the control node, as well as
Visual Studio and Atom via RDP</div></blockquote>
</div>
<div class="section" id="step-2">
<h3>Step 2<a class="headerlink" href="#step-2" title="Permalink to this headline">¶</a></h3>
<p>Enter the following play definition into <code class="docutils literal notranslate"><span class="pre">bigip-error-handling.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">BIG-IP SETUP</span>
  <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lb</span>
  <span class="nt">connection</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local</span>
  <span class="nt">gather_facts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">---</span></code> at the top of the file indicates that this is a YAML
file.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">hosts:</span> <span class="pre">f5</span></code>, indicates the play is run only on the F5 BIG-IP
device</li>
<li><code class="docutils literal notranslate"><span class="pre">connection:</span> <span class="pre">local</span></code> tells the Playbook to run locally (rather than
SSHing to itself)</li>
<li><code class="docutils literal notranslate"><span class="pre">gather_facts:</span> <span class="pre">false</span></code> disables facts gathering. We are not using
any fact variables for this playbook.</li>
</ul>
</div>
<div class="section" id="step-3">
<h3>Step 3<a class="headerlink" href="#step-3" title="Permalink to this headline">¶</a></h3>
<p>Add a tasks section with a set_fact for setting the provider values</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">BIG-IP SETUP</span>
  <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lb</span>
  <span class="nt">connection</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local</span>
  <span class="nt">gather_facts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Setup provider</span>
      <span class="nt">set_fact</span><span class="p">:</span>
       <span class="nt">provider</span><span class="p">:</span>
        <span class="nt">server</span><span class="p">:</span> <span class="s">&quot;{{private_ip}}&quot;</span>
        <span class="nt">user</span><span class="p">:</span> <span class="s">&quot;{{ansible_user}}&quot;</span>
        <span class="nt">password</span><span class="p">:</span> <span class="s">&quot;{{ansible_ssh_pass}}&quot;</span>
        <span class="nt">server_port</span><span class="p">:</span> <span class="s">&quot;8443&quot;</span>
        <span class="nt">validate_certs</span><span class="p">:</span> <span class="s">&quot;no&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="step-4">
<h3>Step 4<a class="headerlink" href="#step-4" title="Permalink to this headline">¶</a></h3>
<p>Next, add the <code class="docutils literal notranslate"><span class="pre">block</span></code> stanza and the first <code class="docutils literal notranslate"><span class="pre">task</span></code>. The first task
will be the bigip_node as performed in <a class="reference internal" href="../module1/1.2-add-node.html#add-node"><span class="std std-ref">Exercise 1.2 - Adding nodes to
F5 BIG-IP</span></a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">BIG-IP SETUP</span>
  <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lb</span>
  <span class="nt">connection</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local</span>
  <span class="nt">gather_facts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>

  <span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Setup provider</span>
      <span class="l l-Scalar l-Scalar-Plain">set_fact</span><span class="p p-Indicator">:</span>
       <span class="nt">provider</span><span class="p">:</span>
        <span class="nt">server</span><span class="p">:</span> <span class="s">&quot;{{private_ip}}&quot;</span>
        <span class="nt">user</span><span class="p">:</span> <span class="s">&quot;{{ansible_user}}&quot;</span>
        <span class="nt">password</span><span class="p">:</span> <span class="s">&quot;{{ansible_ssh_pass}}&quot;</span>
        <span class="nt">server_port</span><span class="p">:</span> <span class="s">&quot;8443&quot;</span>
        <span class="nt">validate_certs</span><span class="p">:</span> <span class="s">&quot;no&quot;</span>

  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Setup and graceful rollback BIG-IP configuration</span>
    <span class="nt">block</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CREATE NODES</span>
        <span class="nt">bigip_node</span><span class="p">:</span>
         <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
         <span class="nt">host</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].ansible_host}}&quot;</span>
         <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].inventory_hostname}}&quot;</span>
        <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">groups[&#39;webservers&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="step-5">
<h3>Step 5<a class="headerlink" href="#step-5" title="Permalink to this headline">¶</a></h3>
<p>Next, add the second task for bigip_pool as demonstrated in <a class="reference internal" href="../module1/1.3-add-pool.html#add-pool"><span class="std std-ref">Exercise
1.3 - Adding a load balancing pool</span></a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">BIG-IP SETUP</span>
  <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lb</span>
  <span class="nt">connection</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local</span>
  <span class="nt">gather_facts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>

  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Setup provider</span>
      <span class="nt">set_fact</span><span class="p">:</span>
       <span class="nt">provider</span><span class="p">:</span>
        <span class="nt">server</span><span class="p">:</span> <span class="s">&quot;{{private_ip}}&quot;</span>
        <span class="nt">user</span><span class="p">:</span> <span class="s">&quot;{{ansible_user}}&quot;</span>
        <span class="nt">password</span><span class="p">:</span> <span class="s">&quot;{{ansible_ssh_pass}}&quot;</span>
        <span class="nt">server_port</span><span class="p">:</span> <span class="s">&quot;8443&quot;</span>
        <span class="nt">validate_certs</span><span class="p">:</span> <span class="s">&quot;no&quot;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SETUP AND GRACEFUL ROLLBACK BIG-IP CONFIGURATION</span>
      <span class="nt">block</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CREATE NODES</span>
          <span class="nt">bigip_node</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">host</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].ansible_host}}&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].inventory_hostname}}&quot;</span>
          <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">groups[&#39;webservers&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CREATE POOL</span>
          <span class="nt">bigip_pool</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;http_pool&quot;</span>
            <span class="nt">lb_method</span><span class="p">:</span> <span class="s">&quot;round-robin&quot;</span>
            <span class="nt">monitors</span><span class="p">:</span> <span class="s">&quot;/Common/http&quot;</span>
            <span class="nt">monitor_type</span><span class="p">:</span> <span class="s">&quot;and_list&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="step-6">
<h3>Step 6<a class="headerlink" href="#step-6" title="Permalink to this headline">¶</a></h3>
<p>Next, add the third task. For the third task use the bigip_pool_member
as demonstrated in <a class="reference internal" href="../module1/1.4-add-pool-members.html#add-pool-members"><span class="std std-ref">Exercise 1.4 - Adding members to a
pool</span></a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">BIG-IP SETUP</span>
  <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lb</span>
  <span class="nt">connection</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local</span>
  <span class="nt">gather_facts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>

  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Setup provider</span>
      <span class="nt">set_fact</span><span class="p">:</span>
       <span class="nt">provider</span><span class="p">:</span>
        <span class="nt">server</span><span class="p">:</span> <span class="s">&quot;{{private_ip}}&quot;</span>
        <span class="nt">user</span><span class="p">:</span> <span class="s">&quot;{{ansible_user}}&quot;</span>
        <span class="nt">password</span><span class="p">:</span> <span class="s">&quot;{{ansible_ssh_pass}}&quot;</span>
        <span class="nt">server_port</span><span class="p">:</span> <span class="s">&quot;8443&quot;</span>
        <span class="nt">validate_certs</span><span class="p">:</span> <span class="s">&quot;no&quot;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SETUP AND GRACEFUL ROLLBACK BIG-IP CONFIGURATION</span>
      <span class="nt">block</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CREATE NODES</span>
          <span class="nt">bigip_node</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">host</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].ansible_host}}&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].inventory_hostname}}&quot;</span>
          <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">groups[&#39;webservers&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CREATE POOL</span>
          <span class="nt">bigip_pool</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;http_pool&quot;</span>
            <span class="nt">lb_method</span><span class="p">:</span> <span class="s">&quot;round-robin&quot;</span>
            <span class="nt">monitors</span><span class="p">:</span> <span class="s">&quot;/Common/http&quot;</span>
            <span class="nt">monitor_type</span><span class="p">:</span> <span class="s">&quot;and_list&quot;</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ADD POOL MEMBERS</span>
          <span class="nt">bigip_pool_member</span><span class="p">:</span>
           <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
           <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;present&quot;</span>
           <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].inventory_hostname}}&quot;</span>
           <span class="nt">host</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].ansible_host}}&quot;</span>
           <span class="nt">port</span><span class="p">:</span> <span class="s">&quot;80&quot;</span>
           <span class="nt">pool</span><span class="p">:</span> <span class="s">&quot;http_pool&quot;</span>
          <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">groups[&#39;webservers&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="step-7">
<h3>Step 7<a class="headerlink" href="#step-7" title="Permalink to this headline">¶</a></h3>
<p>Next, add the fourth task. For the fourth task use the
bigip_virtual_server as demonstrated in <a class="reference internal" href="../module1/1.5-add-virtual-server.html#add-virtual-server"><span class="std std-ref">Exercise 1.5 - Adding a virtual
server</span></a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">BIG-IP SETUP</span>
  <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lb</span>
  <span class="nt">connection</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local</span>
  <span class="nt">gather_facts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>

  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Setup provider</span>
      <span class="nt">set_fact</span><span class="p">:</span>
       <span class="nt">provider</span><span class="p">:</span>
        <span class="nt">server</span><span class="p">:</span> <span class="s">&quot;{{private_ip}}&quot;</span>
        <span class="nt">user</span><span class="p">:</span> <span class="s">&quot;{{ansible_user}}&quot;</span>
        <span class="nt">password</span><span class="p">:</span> <span class="s">&quot;{{ansible_ssh_pass}}&quot;</span>
        <span class="nt">server_port</span><span class="p">:</span> <span class="s">&quot;8443&quot;</span>
        <span class="nt">validate_certs</span><span class="p">:</span> <span class="s">&quot;no&quot;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SETUP AND GRACEFUL ROLLBACK BIG-IP CONFIGURATION</span>
      <span class="nt">block</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CREATE NODES</span>
          <span class="nt">bigip_node</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">host</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].ansible_host}}&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].inventory_hostname}}&quot;</span>
          <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">groups[&#39;webservers&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CREATE POOL</span>
          <span class="nt">bigip_pool</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;http_pool&quot;</span>
            <span class="nt">lb_method</span><span class="p">:</span> <span class="s">&quot;round-robin&quot;</span>
            <span class="nt">monitors</span><span class="p">:</span> <span class="s">&quot;/Common/http&quot;</span>
            <span class="nt">monitor_type</span><span class="p">:</span> <span class="s">&quot;and_list&quot;</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ADD POOL MEMBERS</span>
          <span class="nt">bigip_pool_member</span><span class="p">:</span>
           <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
           <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;present&quot;</span>
           <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].inventory_hostname}}&quot;</span>
           <span class="nt">host</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].ansible_host}}&quot;</span>
           <span class="nt">port</span><span class="p">:</span> <span class="s">&quot;80&quot;</span>
           <span class="nt">pool</span><span class="p">:</span> <span class="s">&quot;http_pool&quot;</span>
          <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">groups[&#39;webservers&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ADD VIRTUAL SERVER</span>
          <span class="nt">bigip_virtual_server</span><span class="p">:</span>
           <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
           <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;vip&quot;</span>
           <span class="nt">destination</span><span class="p">:</span> <span class="s">&quot;{{private_ip}}&quot;</span>
           <span class="nt">port</span><span class="p">:</span> <span class="s">&quot;443&quot;</span>
           <span class="nt">enabled_vlans</span><span class="p">:</span> <span class="s">&quot;all&quot;</span>
           <span class="nt">all_profiles</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;http&#39;</span><span class="p p-Indicator">,</span><span class="s">&#39;clientssl&#39;</span><span class="p p-Indicator">,</span><span class="s">&#39;oneconnect&#39;</span><span class="p p-Indicator">]</span>
           <span class="nt">pool</span><span class="p">:</span> <span class="s">&quot;http_pool&quot;</span>
           <span class="nt">snat</span><span class="p">:</span> <span class="s">&quot;Automap1&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="step-7-1">
<span id="id1"></span><h3>Step 7<a class="headerlink" href="#step-7-1" title="Permalink to this headline">¶</a></h3>
<p>Next, add the <strong>rescue</strong> stanza. The tasks under the <code class="docutils literal notranslate"><span class="pre">rescue</span></code> stanza
will be identical to <a class="reference internal" href="../module1/1.6-add-irules.html#add-irules"><span class="std std-ref">Exercise 1.6 - Deleting F5 BIG-IP
Configuration</span></a>. The
bigip_pool_member task does not need to re-enterered since by deleting
the nodes and pool will remove all configuration. If any task within the
<strong>block</strong> fails, the <strong>rescue</strong> stanza will execute in order. The VIP,
pool, and nodes will be removed gracefully.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">BIG-IP SETUP</span>
  <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lb</span>
  <span class="nt">connection</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local</span>
  <span class="nt">gather_facts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>

  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Setup provider</span>
      <span class="nt">set_fact</span><span class="p">:</span>
       <span class="nt">provider</span><span class="p">:</span>
        <span class="nt">server</span><span class="p">:</span> <span class="s">&quot;{{private_ip}}&quot;</span>
        <span class="nt">user</span><span class="p">:</span> <span class="s">&quot;{{ansible_user}}&quot;</span>
        <span class="nt">password</span><span class="p">:</span> <span class="s">&quot;{{ansible_ssh_pass}}&quot;</span>
        <span class="nt">server_port</span><span class="p">:</span> <span class="s">&quot;8443&quot;</span>
        <span class="nt">validate_certs</span><span class="p">:</span> <span class="s">&quot;no&quot;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SETUP AND GRACEFUL ROLLBACK BIG-IP CONFIGURATION</span>
      <span class="nt">block</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CREATE NODES</span>
          <span class="nt">bigip_node</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">host</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].ansible_host}}&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].inventory_hostname}}&quot;</span>
          <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">groups[&#39;webservers&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CREATE POOL</span>
          <span class="nt">bigip_pool</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;http_pool&quot;</span>
            <span class="nt">lb_method</span><span class="p">:</span> <span class="s">&quot;round-robin&quot;</span>
            <span class="nt">monitors</span><span class="p">:</span> <span class="s">&quot;/Common/http&quot;</span>
            <span class="nt">monitor_type</span><span class="p">:</span> <span class="s">&quot;and_list&quot;</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ADD POOL MEMBERS</span>
          <span class="nt">bigip_pool_member</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;present&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].inventory_hostname}}&quot;</span>
            <span class="nt">host</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].ansible_host}}&quot;</span>
            <span class="nt">port</span><span class="p">:</span> <span class="s">&quot;80&quot;</span>
            <span class="nt">pool</span><span class="p">:</span> <span class="s">&quot;http_pool&quot;</span>
          <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">groups[&#39;webservers&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ADD VIRTUAL SERVER</span>
          <span class="nt">bigip_virtual_server</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;vip&quot;</span>
            <span class="nt">destination</span><span class="p">:</span> <span class="s">&quot;{{private_ip}}&quot;</span>
            <span class="nt">port</span><span class="p">:</span> <span class="s">&quot;443&quot;</span>
            <span class="nt">enabled_vlans</span><span class="p">:</span> <span class="s">&quot;all&quot;</span>
            <span class="nt">all_profiles</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;http&#39;</span><span class="p p-Indicator">,</span><span class="s">&#39;clientssl&#39;</span><span class="p p-Indicator">,</span><span class="s">&#39;oneconnect&#39;</span><span class="p p-Indicator">]</span>
            <span class="nt">pool</span><span class="p">:</span> <span class="s">&quot;http_pool&quot;</span>
            <span class="nt">snat</span><span class="p">:</span> <span class="s">&quot;Automap1&quot;</span>

      <span class="nt">rescue</span><span class="p">:</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DELETE VIRTUAL SERVER</span>
          <span class="nt">bigip_virtual_server</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;vip&quot;</span>
            <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DELETE POOL</span>
          <span class="nt">bigip_pool</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;http_pool&quot;</span>
            <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DELETE NODES</span>
          <span class="nt">bigip_node</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].inventory_hostname}}&quot;</span>
            <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
          <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">groups[&#39;webservers&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="step-8">
<h3>Step 8<a class="headerlink" href="#step-8" title="Permalink to this headline">¶</a></h3>
<p>Finally add the <strong>always</strong> to save the running configuration.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">BIG-IP SETUP</span>
  <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lb</span>
  <span class="nt">connection</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local</span>
  <span class="nt">gather_facts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>

  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Setup provider</span>
      <span class="nt">set_fact</span><span class="p">:</span>
       <span class="nt">provider</span><span class="p">:</span>
        <span class="nt">server</span><span class="p">:</span> <span class="s">&quot;{{private_ip}}&quot;</span>
        <span class="nt">user</span><span class="p">:</span> <span class="s">&quot;{{ansible_user}}&quot;</span>
        <span class="nt">password</span><span class="p">:</span> <span class="s">&quot;{{ansible_ssh_pass}}&quot;</span>
        <span class="nt">server_port</span><span class="p">:</span> <span class="s">&quot;8443&quot;</span>
        <span class="nt">validate_certs</span><span class="p">:</span> <span class="s">&quot;no&quot;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SETUP AND GRACEFUL ROLLBACK BIG-IP CONFIGURATION</span>
      <span class="nt">block</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CREATE NODES</span>
          <span class="nt">bigip_node</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">host</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].ansible_host}}&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].inventory_hostname}}&quot;</span>
          <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">groups[&#39;webservers&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CREATE POOL</span>
          <span class="nt">bigip_pool</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;http_pool&quot;</span>
            <span class="nt">lb_method</span><span class="p">:</span> <span class="s">&quot;round-robin&quot;</span>
            <span class="nt">monitors</span><span class="p">:</span> <span class="s">&quot;/Common/http&quot;</span>
            <span class="nt">monitor_type</span><span class="p">:</span> <span class="s">&quot;and_list&quot;</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ADD POOL MEMBERS</span>
          <span class="nt">bigip_pool_member</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;present&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].inventory_hostname}}&quot;</span>
            <span class="nt">host</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].ansible_host}}&quot;</span>
            <span class="nt">port</span><span class="p">:</span> <span class="s">&quot;80&quot;</span>
            <span class="nt">pool</span><span class="p">:</span> <span class="s">&quot;http_pool&quot;</span>
          <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">groups[&#39;webservers&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ADD VIRTUAL SERVER</span>
          <span class="nt">bigip_virtual_server</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;vip&quot;</span>
            <span class="nt">destination</span><span class="p">:</span> <span class="s">&quot;{{private_ip}}&quot;</span>
            <span class="nt">port</span><span class="p">:</span> <span class="s">&quot;443&quot;</span>
            <span class="nt">enabled_vlans</span><span class="p">:</span> <span class="s">&quot;all&quot;</span>
            <span class="nt">all_profiles</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;http&#39;</span><span class="p p-Indicator">,</span><span class="s">&#39;clientssl&#39;</span><span class="p p-Indicator">,</span><span class="s">&#39;oneconnect&#39;</span><span class="p p-Indicator">]</span>
            <span class="nt">pool</span><span class="p">:</span> <span class="s">&quot;http_pool&quot;</span>
            <span class="nt">snat</span><span class="p">:</span> <span class="s">&quot;Automap1&quot;</span>

      <span class="nt">rescue</span><span class="p">:</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DELETE VIRTUAL SERVER</span>
          <span class="nt">bigip_virtual_server</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;vip&quot;</span>
            <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DELETE POOL</span>
          <span class="nt">bigip_pool</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;http_pool&quot;</span>
            <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>

        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DELETE NODES</span>
          <span class="nt">bigip_node</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{hostvars[item].inventory_hostname}}&quot;</span>
            <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
          <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">groups[&#39;webservers&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">always</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SAVE RUNNING CONFIGURATION</span>
          <span class="nt">bigip_config</span><span class="p">:</span>
            <span class="nt">provider</span><span class="p">:</span> <span class="s">&quot;{{provider}}&quot;</span>
            <span class="nt">save</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
</pre></div>
</div>
<p>The above playbook will try and configure the Virtual Server, Pool and
Nodes but since the snat value is provided as ‘Automap1’ the addition of
virtual server will fail and the ‘rescue’ block will be run</p>
</div>
<div class="section" id="step-9">
<h3>Step 9<a class="headerlink" href="#step-9" title="Permalink to this headline">¶</a></h3>
<p>Run the playbook - exit back into the command line of the control host
and execute the following:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[centos@ansible ~]$</span> ansible-playbook bigip-error-handling.yml
</pre></div>
</div>
</div>
</div>
<div class="section" id="playbook-output">
<h2>Playbook Output<a class="headerlink" href="#playbook-output" title="Permalink to this headline">¶</a></h2>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[centos@ansible ~]$</span> ansible-playbook bigip-error-handling.yml

<span class="gp">[centos@ansible ~]$</span> ansible-playbook bigip-error-handling.yml

<span class="go">PLAY [BIG-IP SETUP] ****************************************************************************************************</span>

<span class="go">TASK [Setup provider] **************************************************************************************************</span>
<span class="go">ok: [f5]</span>

<span class="go">TASK [CREATE NODES] *****************************************************************************************************</span>
<span class="go">changed: [f5] =&gt; (item=host1)</span>
<span class="go">changed: [f5] =&gt; (item=host2)</span>

<span class="go">TASK [CREATE POOL] *******************************************************************************************************</span>
<span class="go">changed: [f5]</span>

<span class="go">TASK [ADD POOL MEMBERS] **************************************************************************************************************************</span>
<span class="go">changed: [f5] =&gt; (item=host1)</span>
<span class="go">changed: [f5] =&gt; (item=host2)</span>

<span class="go">TASK [ADD VIRTUAL SERVER] ***************************************************************************************************************************</span>
<span class="go">fatal: [f5]: FAILED! =&gt; {&quot;changed&quot;: false, &quot;msg&quot;: &quot;0107163f:3: Pool (/Common/Automap1) of type (snatpool) doesn&#39;t exist.&quot;}</span>

<span class="go">TASK [DELETE VIRTUAL SERVER] **************************************************************************************************************************</span>
<span class="go">ok: [f5]</span>

<span class="go">TASK [DELETE POOL] **************************************************************************************************************************</span>
<span class="go">changed: [f5]</span>

<span class="go">TASK [DELETE NODES] **************************************************************************************************************************</span>
<span class="go">changed: [f5] =&gt; (item=host1)</span>
<span class="go">changed: [f5] =&gt; (item=host2)</span>

<span class="go">TASK [SAVE RUNNING CONFIGURATION] ***************************************************************************************************************************</span>
<span class="go">changed: [f5]</span>

<span class="go">PLAY RECAP *****************************************************************************************************************</span>
<span class="go">f5                         : ok=8    changed=6    unreachable=0    failed=1</span>
</pre></div>
</div>
</div>
<div class="section" id="solution">
<h2>Solution<a class="headerlink" href="#solution" title="Permalink to this headline">¶</a></h2>
<p>The finished Ansible Playbook is provided here for an Answer key. Click
here:
<a class="reference download internal" download="" href="../../_downloads/0bb2b4a37d83718a48fb6fcdad7693c0/bigip-error-handling.yml"><code class="xref download docutils literal notranslate"><span class="pre">bigip-error-handling.yml</span></code></a>.</p>
<p>You have finished this exercise. <a class="reference external" href="..">Click here to return to the lab
guide</a></p>
</div>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="2.1-delete-configuration.html" title="Exercise 2.1: Using a combination of modules to delete configuration on the BIG-IP" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="../module3/module3.html" title="Section 3 - Ansible F5 AS3 Exercises" accesskey="n" class="btn btn-primary right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/index.js"></script>
  <script src="../../_static/js/jquery.appear.js"></script>
  <script src="../../_static/js/printThis.js"></script>
  <script src="../../_static/js/bootstrap.min.js"></script>
  <script src="../../_static/js/clouddocs.js"></script>
  <script src="../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>